var ZegoExpressPlayer;(()=>{"use strict";var e,t,i={361:(e,t,i)=>{var o,r,n;!function(e){e.RESET="reset",e.DOWNLOAD="download",e.PLAY="play",e.PAUSE="pause",e.SRC_CHANGED="mediaResourceChanged",e.SET_VOLUME="setVolume",e.STOP="stop",e.TASK="NewTask",e.PLAYER_EVENT_EMIT="playerEventEmit"}(o||(o={})),function(e){e.VIDEO_BUFFER_POP="videoBufferPop",e.AUDIO_BUFFER_POP="audioBufferPop",e.MEDIA_BUFFER_LOCK="mediaLock",e.MEDIA_BUFFER_UNLOCK="mediaBufferUnlock"}(r||(r={})),function(e){e.DECODER="decoder",e.LOADER="loader",e.RENDER="render",e.EVENT_EMITTER="playerEventEmitter",e.DATA_MANAGER="dataManager",e.LOGGER_MANAGER="logger",e.ERROR_HANDLER="errorHandler",e.PLAYER_CONTROLLER="playerController",e.QUALITY_STATISTIC="qualityStatistic"}(n||(n={}));const s="__ZegoError___";class a extends Error{constructor(e){super(JSON.stringify(e)),this.name=s}}function d(e,t){return{code:t.code,msg:t.msg+": "+e}}const c={code:100003,msg:"RuntimeError"},h={code:100004,msg:"NetworkError"},l={code:100005,msg:"DecodeError"};class u extends a{constructor(e){super(d(e,c))}}class f extends a{constructor(e){super(d(e,h))}}class _ extends a{constructor(e){super(d(e,l))}}class g{constructor(e){if(e.min>e.max)throw new u("illegal value!");this._min=e.min,this._max=e.max}get max(){return this._max}get min(){return this._min}contain(e){return e>=this._min&&e<=this._max}onLeft(e){return e<this._min}onRight(e){return e>this._max}}class m{constructor(e){this._param=e,this._error=!1,this._negate=!1}static bind(e){return new m(e)}static expect(e){return new m(e)}_verify(e){let t=e();return t=this._negate?!t:t,t||(this._error=!0),this._negate=!1,this}get is(){return this}get not(){return this._negate=!this._negate,this}get true(){return this._verify((()=>"boolean"==typeof this._param&&!0===this._param))}get false(){return this._verify((()=>"boolean"==typeof this._param&&!1===this._param))}get exist(){return this._verify((()=>void 0!==this._param&&null!==this._param))}then(e){return this._param=e,this}oneOf(e){return this._verify((()=>e.some((e=>e===this._param))))}keyof(e){return this._verify((()=>("object"==typeof e||"function"==typeof e)&&e.hasOwnProperty(this._param)))}hasKey(e){return this._verify((()=>("object"==typeof this._param||"function"==typeof this._param)&&(this._param.hasOwnProperty(e)||void 0!==this._param[e])))}verify(e){return this._verify((()=>e(this._param)))}equal(e){return this._verify((()=>this._param===e))}eq(e){return this.equal(e)}typeof(e){return this._verify((()=>typeof this._param===e))}range([e,t]){return this._verify((()=>"number"==typeof this._param&&new g({min:e,max:t}).contain(this._param)))}contain(e){return this._verify((()=>"number"==typeof this._param&&e.contain(this._param)))}instanceof(e){return this._verify((()=>this._param instanceof e))}catch(e){return e&&this._error&&e(),this._error=!1,this}}i(892);const p="_action_";function y(e,t){const i=()=>!t||void 0===t.callInfo||t.callInfo;return function(...t){const[o,r,n]=t;if(n){const t=n.value;return n.value=function(){const r=Reflect.getMetadata(p,o.constructor),n=this.logger,s=n.action;m.bind(r).is.exist.not.eq("").catch((()=>{throw new u(`class ${o.constructor.name} don't have an action.`)})),m.bind(n).is.exist.catch((()=>{throw new u(`class ${o.constructor.name} is missing the attribute 'logger'.`)})),n.action="zep."+r+"."+e;const a=[];for(let e=0;e<arguments.length;e++)"function"==typeof arguments[e]&&a.push("[func]"),"object"==typeof arguments[e]&&a.push("[obj]"),"function"!=typeof arguments[e]&&"object"!=typeof arguments[e]&&a.push(arguments[e]);let d,c="call";0!==a.length&&(c+=", args:[ "+a.join(", ")+" ]"),i()&&n.info(c);try{d=t.apply(this,arguments),d instanceof Promise?d.then((()=>{n.action="zep."+r+"."+e,i(),n.action=s})):i()}catch(e){throw n.action=s,e}return n.action=s,d},n}Reflect.defineMetadata(p,e,o)}}class E{constructor(e,t,i){this._metainfo=e,this._action=t,this._logCache=i}get _prefix(){return`${this._action} ${this._metainfo} `}get _log(){return this._logCache}set metainfo(e){this._metainfo=e}get metainfo(){return this._metainfo}set action(e){this._action=e}get action(){return this._action}getSubAction(e){return this.action+"."+e}sub(e){return new E(this.metainfo,this.getSubAction(e),this._log)}info(...e){this._log.add("info",[this._prefix,...e])}warn(...e){this._log.add("warn",[this._prefix,...e])}error(...e){this._log.add("error",[this._prefix,...e])}}class v{constructor(e,t){this._global=e,this._action=t}static create(e,t){const i=Reflect.getMetadata(p,e);return new v(t,"zep."+i)}_postLog(e,t){const i={target:n.LOGGER_MANAGER,type:"workerlog",data:{level:e,args:t,action:this._action}};this._global.postMessage(i)}set action(e){this._action=e}get action(){return this._action}info(...e){this._postLog("info",e)}warn(...e){this._postLog("warn",e)}error(...e){this._postLog("error",e)}}var R=i(142);const b=i.p+"asset/767e8a3ee282f679ec7c.gz",M=i.p+"asset/f48e1e55f206f96e2078.js";var A=function(e,t,i,o){return new(i||(i=Promise))((function(r,n){function s(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}d((o=o.apply(e,t||[])).next())}))};const w="promise aborted";class D{constructor(){this._map=new Map}get(e){let t=this._map.get(e);return t||(this._map.set(e,new I),t=this._map.get(e)),t}reset(){this._map.forEach((e=>{e.reset()})),this._map=new Map}}class I{constructor(){this._list=[]}add(...e){this._list.push(...e)}reset(){this._list.forEach((e=>{e.abort(w)})),this._list=[]}all(){return A(this,void 0,void 0,(function*(){const e=[];this._list.forEach((t=>{e.push(t.promise)})),yield Promise.all(e),this._list=[]}))}}class P{constructor(e){const t=new Promise(e),i=new Promise(((e,t)=>{this._abort=t}));this._promise=Promise.race([t,i])}get promise(){return this._promise}abort(e){this._abort(e)}}var T=i(204);class O{static getBrowser(){var e,t={},i=navigator.userAgent.toLowerCase();return(e=i.match(/msie ([\d.]+)/))?t.ie=e[1]:(e=i.match(/firefox\/([\d.]+)/))?t.firefox=e[1]:(e=i.match(/chrome\/([\d.]+)/))?t.chrome=e[1]:(e=i.match(/opera.([\d.]+)/))?t.opera=e[1]:(e=i.match(/version\/([\d.]+).*safari/))&&(t.safari=e[1]),t.ie?"ie":t.firefox?"firefox":t.chrome?"chrome":t.opera?"opera":t.safari?"safari":"unknown"}static change2fullPath(e){const t=document.createElement("A");return t.href=e,e=t.href}static deepClone(e){return JSON.parse(JSON.stringify(e))}static wait(e){return new Promise((t=>{setTimeout((()=>t()),e)}))}static isFlvMediaSource(e){if(""===e)return!1;e=O.change2fullPath(e);return new URL(e).pathname.endsWith("flv")}}class F{constructor(e){this._info={frameWidth:0,frameHeight:0,frameRate:0,sampleRate:0,channelCount:0,formatName:"",videoCodecName:"",audioCodecName:"",duration:-1},e&&(this._info=Object.assign(Object.assign({},this._info),e))}equal(e){return this.frameWidth===e.frameWidth&&this.frameHeight===e.frameHeight&&this.frameRate===e.frameRate&&this.sampleRate===e.sampleRate&&this.channelCount===e.channelCount&&this.formatName===e.formatName&&this.videoCodecName===e.videoCodecName&&this.audioCodecName===e.audioCodecName&&this.duration===e.duration}get noAudioInfo(){return Object.assign(Object.assign({},this.info),{channelCount:0,sampleRate:0,audioCodecName:""})}get noVideoInfo(){return Object.assign(Object.assign({},this.info),{frameWidth:0,frameHeight:0,videoCodecName:""})}get info(){return O.deepClone(this._info)}get sampleRate(){return this._info.sampleRate}get frameHeight(){return this._info.frameHeight}get frameWidth(){return this._info.frameWidth}get duration(){return this._info.duration}get channelCount(){return this._info.channelCount}get noVideo(){return this._info.frameHeight<=0||this._info.frameWidth<=0}get noAudio(){return this._info.sampleRate<=0||this._info.channelCount<=0}get videoCodecName(){return this._info.videoCodecName}get audioCodecName(){return this._info.audioCodecName}get formatName(){return this._info.formatName}get frameRate(){return this._info.frameRate}validate(){return this.sampleRate>=3e3&&this.sampleRate<=768e3&&this.channelCount>0||this.frameWidth>0&&this.frameHeight>0}toString(){return`media info: ${JSON.stringify(this.info,null,2)} noVideo=${this.noVideo}, noAudio=${this.noAudio}`}}class C{static _getLeftPCMBuffer(e){const t=new Int32Array(Math.floor(e.length/2));for(let i=0;i<e.length;i+=2)t[Math.floor(i/2)]=e[i];return t}static _getRightPCMBuffer(e){const t=new Int32Array(Math.floor(e.length/2));for(let i=1;i<e.length;i+=2)t[Math.floor(i/2)]=e[i];return t}static PCMToIEEEFloat(e){const t=new Float32Array(e.length);for(let i=0;i<e.length;i++){const o=e[i];t[i]=o<0?o/2147483648:o/2147483647}return t}static getLeftChannelData(e){const t=this._getLeftPCMBuffer(e);return this.PCMToIEEEFloat(t)}static getRightChannelData(e){const t=this._getRightPCMBuffer(e);return this.PCMToIEEEFloat(t)}}var S=i(415),N=i(235);class L{update(e){this._model=Object.assign(Object.assign({},this._model),e)}getModel(){return Object.assign({},this._model)}}var j=i(566);var U=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},k=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let B=class{constructor(){this._model=new L;const e={appid:0,version:"1.0.0",instanceid:(0,j.x0)(6),advanceConfig:{videoPausedSeiNeeded:!1}};this._model.update(e)}setConfig(e){this._model.update(e)}get appid(){return this._model.getModel().appid}get version(){return this._model.getModel().version}get instanceid(){return this._model.getModel().instanceid}get advanceConfig(){return this._model.getModel().advanceConfig}};B=U([(0,S.b)(),k("design:paramtypes",[])],B);class x{constructor(){this._MAX_CACHE=10240,this._cache=[]}setLogger(e){this._logger=e}add(e,t){this._cache.length<this._MAX_CACHE&&this._cache.push({type:e,args:t}),this._clear()}_log(e){switch(e.type){case"info":this._logger&&this._logger.info(...e.args);break;case"warn":this._logger&&this._logger.warn(...e.args);break;case"error":this._logger&&this._logger.error(...e.args)}}_clear(){this._logger&&(this._cache.forEach((e=>{this._log(e)})),this._cache=[])}}var V=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},W=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},H=function(e,t){return function(i,o){t(i,o,e)}};let Y=class{constructor(e){this._configState=e,this._logCache=new x}get metainfo(){return`p#${this._configState.instanceid}#${this._configState.version}`}get logger(){return this._logger}classLogger(e){const t=Reflect.getMetadata(p,e);return new E(this.metainfo,"zep."+t,this._logCache)}setZegoLogger(e){this._logCache.setLogger(e)}postMessage(e){}onmessage(e){const{type:t,data:i}=e;switch(t){case"workerlog":{const{level:e,action:t,args:o}=i,r=()=>`${t} ${this.metainfo} `;"info"===e?this._logCache.add("info",[r(),...o]):"warn"===e?this._logCache.add("warn",[r(),...o]):"error"===e&&this._logCache.add("error",[r(),...o]);break}default:this._logCache.add("error",[`zep.0.err ${this.metainfo} `,"unknown msg type: ",e.type])}}terminate(){}};Y=V([(0,S.b)(),H(0,(0,N.f)(B)),W("design:paramtypes",[B])],Y);var G,z,$=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},Z=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},q=function(e,t){return function(i,o){t(i,o,e)}};!function(e){e.MEDIA_CAN_PLAY="canplay",e.MEDIA_PLAYED="played",e.MEDIA_PAUSED="paused",e.MEDIA_LOADED="loaded",e.CURRENT_TIME_CHANGE="currentTimeChanged",e.MEDIA_PLAY_ENDED="ended",e.MEDIA_PLAY_WAITING="waiting",e.MEDIA_PLAYING="playing",e.ERROR="ERROR",e.MEDIA_INFO_UPDATE="mediaInfoUpdate",e.RECV_SEI="recvSEI"}(z||(z={}));let J=G=class extends T{constructor(e){super(),this._loggerManager=e,this.logger=this._loggerManager.classLogger(G)}onmessage(e){if(e.type===o.PLAYER_EVENT_EMIT)this.logger.info("msg: ",e.type),this.emit(e.data.eventName,...e.data.args);else this.logger.error("unknown msg type: ",e.type)}postMessage(e){}terminate(){this.removeAllListeners()}};J=G=$([(0,S.b)(),y("0.peve"),q(0,(0,N.f)(Y)),Z("design:paramtypes",[Y])],J);var K=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},Q=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let X=class{_checkPlayedEvent(){!this._playedEvent&&this.audioDeviceReady&&this.played&&this.mediaOpened&&(this._playerEmitter.emit(z.MEDIA_PLAYED),this._playedEvent=!0)}constructor(){this._model=new L,this._playedEvent=!1;const e={taskID:0,url:"",mediaInfo:new F,isPlay:!1,loaded:!1,volume:100,currentTime:0,decodeEnded:!1,mediaPlayEnded:!1,muted:!1,waiting:!1,destroy:!1,mediaOpened:!1,audioDeviceReady:!1};this._model.update(e)}set mediaPlayEnded(e){const t=e&&!this.mediaPlayEnded;this._model.update({mediaPlayEnded:e}),t&&this._playerEmitter.emit(z.MEDIA_PLAY_ENDED)}get mediaPlayEnded(){return this._model.getModel().mediaPlayEnded}set audioDeviceReady(e){this._model.update({audioDeviceReady:e}),this._checkPlayedEvent()}get audioDeviceReady(){return this._model.getModel().audioDeviceReady}set decodeEnded(e){this._model.update({decodeEnded:e})}get decodeEnded(){return this._model.getModel().decodeEnded}set url(e){this.loaded=!1,this.decodeEnded=!1,this.mediaPlayEnded=!1,this.mediaInfo=new F,this.mediaOpened=!1,this.url!==e&&(this.currentTime=0,this.waiting=!1),this._model.update({url:e}),this._playedEvent=!1}get url(){return this._model.getModel().url}set mediaOpened(e){e&&!this.mediaOpened&&(this._playerEmitter.emit(z.MEDIA_CAN_PLAY),this._checkPlayedEvent()),this._model.update({mediaOpened:e})}get mediaOpened(){return this._model.getModel().mediaOpened}set played(e){this._model.update({isPlay:e}),this._checkPlayedEvent()}get played(){return this._model.getModel().isPlay}set paused(e){const t=e&&!this.paused;this._model.update({isPlay:!e}),t&&(this._playedEvent=!1),t&&this._playerEmitter.emit(z.MEDIA_PAUSED)}get paused(){return!this._model.getModel().isPlay}set volume(e){this._model.update({volume:e})}get volume(){return this._model.getModel().volume}set currentTime(e){(e=Number(e.toFixed(2)))>=0&&e!==this.currentTime&&(this.mediaInfo.duration<0||e<=this.mediaInfo.duration)&&(this._model.update({currentTime:e}),this._playerEmitter.emit(z.CURRENT_TIME_CHANGE))}get currentTime(){return this._model.getModel().currentTime}set loaded(e){const t=e&&!this.loaded;this._model.update({loaded:e}),t&&this._playerEmitter.emit(z.MEDIA_LOADED)}get loaded(){return this._model.getModel().loaded}set mediaInfo(e){this._model.update({mediaInfo:e}),e.validate()&&(this.mediaInfo.noAudio?this._playerEmitter.emit(z.MEDIA_INFO_UPDATE,this.mediaInfo.noAudioInfo):this.mediaInfo.noVideo?this._playerEmitter.emit(z.MEDIA_INFO_UPDATE,this.mediaInfo.noVideoInfo):this._playerEmitter.emit(z.MEDIA_INFO_UPDATE,this.mediaInfo.info))}get mediaInfo(){return this._model.getModel().mediaInfo}get duration(){return this._model.getModel().mediaInfo.duration}set muted(e){this._model.update({muted:e})}get muted(){return this._model.getModel().muted}set waiting(e){const t=e&&!this.waiting&&this.played;e?(this._model.update({waiting:e}),t&&this._playerEmitter.emit(z.MEDIA_PLAY_WAITING)):this.playing=!e}get waiting(){return this._model.getModel().waiting}set playing(e){const t=e&&!this.playing;e?(this._model.update({waiting:!e}),t&&!this.mediaPlayEnded&&this._playerEmitter.emit(z.MEDIA_PLAYING)):this.waiting=!e}get playing(){return!this._model.getModel().waiting}set destroy(e){this._model.update({destroy:e})}get destroy(){return this._model.getModel().destroy}set taskID(e){this._model.update({taskID:e})}get taskID(){return this._model.getModel().taskID}};K([(0,N.f)(J),Q("design:type",J)],X.prototype,"_playerEmitter",void 0),X=K([(0,S.b)(),Q("design:paramtypes",[])],X);var ee,te,ie,oe=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},re=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ne=function(e,t){return function(i,o){t(i,o,e)}};!function(e){e.UPDATE_MODEL="updateModel"}(te||(te={})),function(e){e.PLAYER_STATE="playerState",e.CONFIG_STATE="configState"}(ie||(ie={}));let se=ee=class{constructor(e,t,i){this._playerState=e,this._configState=t,this._logManager=i,this.logger=this._logManager.classLogger(ee)}_setProp(e,t,i){e[t]=i}_updatePlayerState(e){for(const t of Object.keys(e)){const i=t,o=e[i];void 0!==o&&this._setProp(this._playerState,i,o)}}_updateConfigState(e){for(const t of Object.keys(e)){const i=t,o=e[i];void 0!==o&&this._setProp(this._configState,i,o)}}_updateModel(e,t){switch(e){case ie.PLAYER_STATE:this.logger.info("update player state",t),this._updatePlayerState(t);break;case ie.CONFIG_STATE:this.logger.info("update config state",t),this._updateConfigState(t);break;default:this.logger.error("unknown model name: ",e)}}postMessage(e){}onmessage(e){switch(e.type){case te.UPDATE_MODEL:{const{modelName:t,model:i}=e.data;this._updateModel(t,i);break}default:this.logger.error("unknown msg type: ",e.type)}}terminate(){}};var ae;oe([y("0.uml"),re("design:type",Function),re("design:paramtypes",[String,Object]),re("design:returntype",void 0)],se.prototype,"_updateModel",null),se=ee=oe([(0,S.b)(),y("0.dmg"),ne(0,(0,N.f)(X)),ne(1,(0,N.f)(B)),ne(2,(0,N.f)(Y)),re("design:paramtypes",[X,B,Y])],se),function(e){e.ResetStatistic="ResetStatistic",e.MediaStartRequest="MediaStartRequest",e.NetworkStartDownloadBody="NetworkStartDownloadBody",e.NetworkFetchFailed="NetworkFetchFailed",e.AudioFirstFrameRecv="AudioFirstFrameRecv",e.AudioRenderFailed="AudioRenderFailed",e.VideoFirstFrameRecv="VideoFirstFrameRecv",e.VideoRenderFailed="VideoRenderFailed"}(ae||(ae={}));var de,ce,he=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},le=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ue=function(e,t,i,o){return new(i||(i=Promise))((function(r,n){function s(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}d((o=o.apply(e,t||[])).next())}))};!function(e){e.READY="decodeReady",e.MEDIA_STATE_UPDATE="mediaStateUpdate"}(ce||(ce={}));let fe=de=class extends T{constructor(){super(),this._inited=!1,this._mediaInfo=new F,this._lastAudioDecodedTime=0,this._lastVideoDecodedTime=0,this._audioDecodeTimeout=null,this._videoDecodeTimeout=null,this._isFirstAudioFrameRecv=!1,this._isFirstVideoFrameRecv=!1,this._decodeTimer=null,this.logger=v.create(de,self)}get ready(){return this._inited}init(e){this._inited?this.logger.info("repeatly initlization"):(this._M=e,this._bindDecodeEvent(),this._inited=!0,this.emit(ce.READY))}_onMediaLoaded(){self.postMessage({target:n.DATA_MANAGER,type:te.UPDATE_MODEL,data:{modelName:ie.PLAYER_STATE,model:{loaded:!0}}})}_onMediaError(e){const{UTF8ToString:t}=this._M,i=t(e),o=JSON.parse(i);switch(this.logger.error(i),o.name){case"NetworkError":throw new f(o.reason);case"DecodeError":throw new _(o.reason)}}_onDecodeEnd(){this.stopDecode(),self.postMessage({target:n.DATA_MANAGER,type:te.UPDATE_MODEL,data:{modelName:ie.PLAYER_STATE,model:{decodeEnded:!0}}})}_onSeiCatch(e,t,i){const o=new Uint8Array(this._M.HEAPU8.subarray(e,e+t));self.postMessage({target:n.RENDER,type:we.RECV_SEI_DATA,data:{sei:o,pts:i}},[o.buffer])}_bindDecodeEvent(){return ue(this,void 0,void 0,(function*(){const{addFunction:e,_bindDecodeCallback:t}=this._M,i=e(this._onMediaLoaded.bind(this),"v"),o=e(this._onMediaInfoUpdate.bind(this),"vi"),r=e(this._onAudioDecoded.bind(this),"viid");t(i,o,e(this._onVideoDecoded.bind(this),"viidii"),r,e(this._onMediaError.bind(this),"vi"),e(this._onDecodeEnd.bind(this),"v"),e(this._onSeiCatch.bind(this),"viid"))}))}_startVideoDecodeTimeout(){this._videoDecodeTimeout=setTimeout((()=>{(performance.now()-this._lastAudioDecodedTime)/1e3<3&&(this._mediaInfo=new F(Object.assign(Object.assign({},this._mediaInfo.info),{frameWidth:0,frameHeight:0})),this._updateMediaInfo(this._mediaInfo)),this._videoDecodeTimeout=null}),5e3)}_sendFirstVideoFrameRecv(){this._isFirstVideoFrameRecv=!0,self.postMessage({target:n.QUALITY_STATISTIC,type:ae.VideoFirstFrameRecv})}_onVideoDecoded(e,t,i,o,r){this._videoDecodeTimeout&&(clearTimeout(this._videoDecodeTimeout),this._videoDecodeTimeout=null),this._lastVideoDecodedTime=performance.now(),this._startVideoDecodeTimeout(),null===this._audioDecodeTimeout&&!this._mediaInfo.noAudio&&this._startAudioDecodeTimeout();const s=new Uint8Array(this._M.HEAPU8.subarray(e,e+t)),a={frame:s,pts:i,width:o,height:r};(this._mediaInfo.noVideo||o!==this._mediaInfo.frameWidth||r!==this._mediaInfo.frameHeight)&&(this._mediaInfo=new F(Object.assign(Object.assign({},this._mediaInfo.info),{frameWidth:o,frameHeight:r})),this._updateMediaInfo(this._mediaInfo)),self.postMessage({target:n.RENDER,type:we.PUSH_VIDEO_BUFFER,data:a},[s.buffer]),this._isFirstVideoFrameRecv||this._sendFirstVideoFrameRecv()}_startAudioDecodeTimeout(){this._audioDecodeTimeout=setTimeout((()=>{(performance.now()-this._lastVideoDecodedTime)/1e3<3&&(this._mediaInfo=new F(Object.assign(Object.assign({},this._mediaInfo.info),{channelCount:0})),this._updateMediaInfo(this._mediaInfo)),this._audioDecodeTimeout=null}),5e3)}_sendFirstAudioFrameRecv(){this._isFirstAudioFrameRecv=!0,self.postMessage({target:n.QUALITY_STATISTIC,type:ae.AudioFirstFrameRecv})}_onAudioDecoded(e,t,i){this._audioDecodeTimeout&&(clearTimeout(this._audioDecodeTimeout),this._audioDecodeTimeout=null),this._lastAudioDecodedTime=performance.now(),this._startAudioDecodeTimeout(),null===this._videoDecodeTimeout&&!this._mediaInfo.noVideo&&this._startVideoDecodeTimeout(),this._mediaInfo.noAudio&&(this._mediaInfo=new F(Object.assign(Object.assign({},this._mediaInfo.info),{channelCount:2})),this._updateMediaInfo(this._mediaInfo));const o=new Uint8Array(this._M.HEAPU8.subarray(e,e+t)),r=new Int32Array(o.buffer),s=C.getLeftChannelData(r),a=C.getRightChannelData(r),d={pts:i,pcm:{leftChannel:s,rightChannel:a}};self.postMessage({target:n.RENDER,type:we.PUSH_AUDIO_BUFFER,data:d},[s.buffer,a.buffer]),this._isFirstAudioFrameRecv||this._sendFirstAudioFrameRecv()}_updateMediaInfo(e){this._mediaInfo=e;const t={sampleRate:e.sampleRate,frameWidth:e.frameWidth,frameHeight:e.frameHeight,frameRate:e.frameRate,duration:e.duration<=0?-1:e.duration,channelCount:e.channelCount,videoCodecName:e.videoCodecName,audioCodecName:e.audioCodecName,formatName:e.formatName};this.logger.info("media info data: ",JSON.stringify(t)),self.postMessage({target:n.RENDER,type:we.MEDIA_INFO_UPDATE,data:t})}_onMediaInfoUpdate(e){const t=this._M.__mediaInfo(e);if(!t)throw new _("can not open media");this.logger.info("media opened, info: "+JSON.stringify(t));const i=()=>{const e=!t.sampleRate||t.sampleRate<3e3;return e&&this.logger.info("no audio"),e};if((()=>{const e=!t.frameWidth||!t.frameHeight;return e&&this.logger.info("no video"),e})()&&i())throw this.logger.info("no video & no audio. media open failed."),this.stopDecode(),new _("open media failed.");this._updateMediaInfo(new F(Object.assign(Object.assign({},t),{channelCount:i()?0:2})))}_stringToPtr(e){const{stringToUTF8:t,_malloc:i,lengthBytesUTF8:o}=this._M,r=i(o(e)+1);return t(e,r,o(e)+1),r}_resetFirstFrameState(){this._isFirstAudioFrameRecv=!1,this._isFirstVideoFrameRecv=!1}_clearDecodeTimer(){null!==this._decodeTimer&&(clearTimeout(this._decodeTimer),this._decodeTimer=null)}_startDecodeTimer(){this._clearDecodeTimer(),this._decodeTimer=setTimeout((()=>{this._M._active(),this._startDecodeTimer()}),16)}decode(e){this._resetFirstFrameState(),this._M._decode(this._stringToPtr(e)),this._startDecodeTimer()}stopDecode(){this._clearDecodeTimer(),this._M._stopDecode()}setSeiConfig(e){this.logger.info(`unregisterSEIFilter="${e.unregisterSEIFilter}", emulationPreventionByte=${e.emulationPreventionByte}`),this._M._setSeiConfig(this._stringToPtr(e.unregisterSEIFilter||""),e.emulationPreventionByte||!1)}videoBufferUpdate(e){this._M._onVideoBufferUpdate(e)}audioBufferUpdate(e){this._M._onAudioBufferUpdate(e)}updateMediaLockState(e){this._M._updateMediaLockState(e)}};he([y("iit"),le("design:type",Function),le("design:paramtypes",[Object]),le("design:returntype",void 0)],fe.prototype,"init",null),he([y("0.udmi"),le("design:type",Function),le("design:paramtypes",[F]),le("design:returntype",void 0)],fe.prototype,"_updateMediaInfo",null),he([y("dec"),le("design:type",Function),le("design:paramtypes",[String]),le("design:returntype",void 0)],fe.prototype,"decode",null),he([y("spdc"),le("design:type",Function),le("design:paramtypes",[]),le("design:returntype",void 0)],fe.prototype,"stopDecode",null),he([y("sic"),le("design:type",Function),le("design:paramtypes",[Object]),le("design:returntype",void 0)],fe.prototype,"setSeiConfig",null),fe=de=he([y("dc.dcer"),le("design:paramtypes",[])],fe);var _e,ge=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},me=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let pe=_e=class{constructor(){this.logger=v.create(_e,self)}_getStringFromCharPtr(e){return this._M.UTF8ToString(e)}_webAssemblyLogInfo(e){this.logger.info(this._getStringFromCharPtr(e))}_webAssemblyLogWarn(e){this.logger.warn(this._getStringFromCharPtr(e))}_webAssemblyLogError(e){this.logger.error(this._getStringFromCharPtr(e))}bind(e){this._M=e;const t=this._M.addFunction(this._webAssemblyLogInfo.bind(this),"vi"),i=this._M.addFunction(this._webAssemblyLogWarn.bind(this),"vi"),o=this._M.addFunction(this._webAssemblyLogError.bind(this),"vi");if(t&&i&&o){const{_bindLoggerCallback:e}=this._M;e(t,i,o)}}};ge([y("i",{callInfo:!1}),me("design:type",Function),me("design:paramtypes",[Number]),me("design:returntype",void 0)],pe.prototype,"_webAssemblyLogInfo",null),ge([y("w",{callInfo:!1}),me("design:type",Function),me("design:paramtypes",[Number]),me("design:returntype",void 0)],pe.prototype,"_webAssemblyLogWarn",null),ge([y("e",{callInfo:!1}),me("design:type",Function),me("design:paramtypes",[Number]),me("design:returntype",void 0)],pe.prototype,"_webAssemblyLogError",null),pe=_e=ge([y("dc.wasm"),me("design:paramtypes",[])],pe);var ye,Ee=function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},ve=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Re=function(e,t,i,o){return new(i||(i=Promise))((function(r,n){function s(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}d((o=o.apply(e,t||[])).next())}))};const be=self;var Me;!function(e){e.WasmReady="wasmReady"}(Me||(Me={}));let Ae=ye=class extends T{constructor(){super(),this._loaded=!1,this._promiseMap=new D,this._decoder=new fe,this._wasmLogListener=new pe,this._decodeLibWasmBlobUrl="",this.logger=v.create(ye,self)}_onModuleRuntimeInitialized(){return Re(this,void 0,void 0,(function*(){this.logger.info("WebAssembly RuntimeInitialized!"),this._M=be.ZegoDecodeModule,this._M.ASAN_OPTIONS="malloc_context_size=0",this._wasmLogListener.bind(this._M),this._decoder.init(this._M),this._bindSendMessage2Wasm(),this._loaded=!0,this.emit(Me.WasmReady)}))}_postMessageFromWasm(e){const{UTF8ToString:t}=this._M,i=t(e),o=JSON.parse(i);self.postMessage(o)}_bindSendMessage2Wasm(){const{_bindSendMessage:e,addFunction:t}=this._M;e(t(this._postMessageFromWasm.bind(this),"vi"))}get _initModuleConfig(){return{locateFile:e=>(this.logger.info("locateFile call"),e.endsWith(".wasm")?this._decodeLibWasmBlobUrl:e),onRuntimeInitialized:()=>Re(this,void 0,void 0,(function*(){yield this._onModuleRuntimeInitialized()}))}}_ungzip(e){return new Promise(((t,i)=>{fetch(e).then((e=>{if(200===e.status)return e.arrayBuffer();throw new Error("cannot fetch resource .gz file")})).then((e=>{const i=R.ZP.ungzip(e);t(i)})).catch((e=>{i(e)}))}))}_buffer2BlobUrl(e){const t=new Blob([e],{type:"application/wasm"});return URL.createObjectURL(t)}load(){return Re(this,void 0,void 0,(function*(){if(!this._loaded)try{const e=yield this._ungzip(b);this._decodeLibWasmBlobUrl=this._buffer2BlobUrl(e),be.ZegoDecodeModule=this._initModuleConfig,be.importScripts(M)}catch(e){throw new u(e.message)}}))}WaitEnvironment(e){return Re(this,void 0,void 0,(function*(){const t=this._promiseMap.get(e);t.reset();const i={},o=()=>Re(this,void 0,void 0,(function*(){t.add(new P(((e,t)=>{this._loaded?e():(i.ready=()=>e(),this.once(Me.WasmReady,i.ready))}))),yield t.all()}));try{return yield o(),!0}catch(t){if(t==w)return this.logger.info(`wait wasm abort. from ${e}`),i.ready&&this.off(Me.WasmReady,i.ready),!1;throw t}}))}setMediaSource(e){return Re(this,void 0,void 0,(function*(){(yield this.WaitEnvironment("setMediaSource"))&&this._decoder.decode(e)}))}updateSEIConfig(e){return Re(this,void 0,void 0,(function*(){(yield this.WaitEnvironment("updateSEIConfig"))&&this._decoder.setSeiConfig(e)}))}videoBufferUpdate(e){return Re(this,void 0,void 0,(function*(){(yield this.WaitEnvironment("videoBufferUpdate"))&&this._decoder.videoBufferUpdate(e)}))}audioBufferUpdate(e){return Re(this,void 0,void 0,(function*(){(yield this.WaitEnvironment("audioBufferUpdate"))&&this._decoder.audioBufferUpdate(e)}))}stop(){return Re(this,void 0,void 0,(function*(){this._promiseMap.reset(),this._loaded?this._decoder.stopDecode():this.logger.info("stop => webassembly not load.")}))}updateMediaBufferLockState(e){return Re(this,void 0,void 0,(function*(){(yield this.WaitEnvironment("updateMediaBufferLockState"))&&this._decoder.updateMediaLockState(e)}))}};var we;Ee([y("0.omrid"),ve("design:type",Function),ve("design:paramtypes",[]),ve("design:returntype",Promise)],Ae.prototype,"_onModuleRuntimeInitialized",null),Ee([y("lod"),ve("design:type",Function),ve("design:paramtypes",[]),ve("design:returntype",Promise)],Ae.prototype,"load",null),Ee([y("stmsc"),ve("design:type",Function),ve("design:paramtypes",[String]),ve("design:returntype",Promise)],Ae.prototype,"setMediaSource",null),Ee([y("seiu"),ve("design:type",Function),ve("design:paramtypes",[Object]),ve("design:returntype",Promise)],Ae.prototype,"updateSEIConfig",null),Ee([y("onstp"),ve("design:type",Function),ve("design:paramtypes",[]),ve("design:returntype",Promise)],Ae.prototype,"stop",null),Ae=ye=Ee([y("dc.wsmld"),ve("design:paramtypes",[])],Ae),function(e){e.PUSH_VIDEO_BUFFER="pushVideoBuffer",e.PUSH_AUDIO_BUFFER="pushAudioBuffer",e.MEDIA_INFO_UPDATE="mediaInfoUpdate",e.DECODE_END="decodeEnded",e.MEDIA_NOT_FETCH="mediaNotFetch",e.RECV_SEI_DATA="recvSeiData",e.SET_SEI_CONFIG="setSeiConfig"}(we||(we={}));const De=new Ae;De.load();const Ie=new v(self,"zep.dc.0");self.onmessage=e=>{const{data:t}=e;if(!t)return;const i=t.type,n=t.data;switch(i){case o.SRC_CHANGED:De.setMediaSource(n.url);break;case o.STOP:Ie.info("onmessage type: "+i),De.stop();break;case we.SET_SEI_CONFIG:De.updateSEIConfig(n.seiConfig);break;case r.VIDEO_BUFFER_POP:De.videoBufferUpdate(n.numberOfPackets);break;case r.AUDIO_BUFFER_POP:De.audioBufferUpdate(n.numberOfPackets);break;case r.MEDIA_BUFFER_LOCK:De.updateMediaBufferLockState(!0);break;case r.MEDIA_BUFFER_UNLOCK:De.updateMediaBufferLockState(!1);break;default:Ie.error("unknown msg type: ",i)}};const Pe=new class{constructor(e,t){this._global=e,this._postMessage=t,this._log=!1,this._errorMap=new Map}_postError(e){const t={target:n.ERROR_HANDLER,type:"onzegoerror",data:{error:e}};if(this._postMessage)this._postMessage(t);else{if(!this._global.postMessage)throw new u("Cannot post error to ErrorHandler.");this._global.postMessage(t)}}_postLog(e){const t={target:n.ERROR_HANDLER,type:"onerrorlog",data:{error:e}};if(this._postMessage)this._postMessage(t);else{if(!this._global.postMessage)throw new u("Cannot post error to ErrorHandler.");this._global.postMessage(t)}}_logError(e){const t=e.error&&e.error.message||e.message;this._postLog(new Error(t))}_logRejection(e){const t=e.reason&&e.reason.message||"unhandledrejection";this._postLog(new Error(t))}_handleError(e){const t=e.error;return!t||t.name!==s||(this._errorMap.get(t)||(this._errorMap.set(t,!0),this._postError(t)),e.preventDefault(e),e.stopPropagation(),!1)}_handleRejection(e){const t=e.reason;return!t||t.name!==s||(this._errorMap.get(t)||(this._errorMap.set(t,!0),this._postError(t)),e.preventDefault(e),e.stopPropagation(),!1)}listen(){this._global.addEventListener("error",(e=>(this._log&&this._logError(e),this._handleError(e)))),this._global.addEventListener("unhandledrejection",(e=>(this._log&&this._logRejection(e),this._handleRejection(e))))}enableLog(){this._log=!0}}(self);Pe.enableLog(),Pe.listen()}},o={};function r(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={exports:{}};return i[e](n,n.exports,r),n.exports}r.m=i,r.x=()=>{var e=r.O(void 0,[49],(()=>r(361)));return e=r.O(e)},e=[],r.O=(t,i,o,n)=>{if(!i){var s=1/0;for(h=0;h<e.length;h++){for(var[i,o,n]=e[h],a=!0,d=0;d<i.length;d++)(!1&n||s>=n)&&Object.keys(r.O).every((e=>r.O[e](i[d])))?i.splice(d--,1):(a=!1,n<s&&(s=n));if(a){e.splice(h--,1);var c=o();void 0!==c&&(t=c)}}return t}n=n||0;for(var h=e.length;h>0&&e[h-1][2]>n;h--)e[h]=e[h-1];e[h]=[i,o,n]},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,i)=>(r.f[i](e,t),t)),[])),r.u=e=>e+".ZegoExpressPlayer-1.0.0.js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var o=i.length-1;o>-1&&!e;)e=i[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{var e={691:1};r.f.i=(t,i)=>{e[t]||importScripts(r.p+r.u(t))};var t=Object("undefined"!=typeof self?self:this).webpackChunkZegoExpressPlayer=Object("undefined"!=typeof self?self:this).webpackChunkZegoExpressPlayer||[],i=t.push.bind(t);t.push=t=>{var[o,n,s]=t;for(var a in n)r.o(n,a)&&(r.m[a]=n[a]);for(s&&s(r);o.length;)e[o.pop()]=1;i(t)}})(),t=r.x,r.x=()=>r.e(49).then(t);var n=r.x();ZegoExpressPlayer=n.ZegoExpressPlayer})();